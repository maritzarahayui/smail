<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <object th:include="~{fragments/common :: js}" th:remove="tag"></object>
    <object th:include="~{fragments/common :: css}" th:remove="tag"></object>

    <link rel="stylesheet" href="/css/dashboard.css" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;700&display=swap" />
</head>

<body>
    <nav th:replace="~{fragments/navbarLoggedIn :: navbarLoggedIn}"></nav>

    <div class="dashboard">
        <div class="home-frame">
            <!-- <b class="header">
                <span class="pengajuan">Dashboard</span>
                <span> Admin</span>
            </b> -->

            <nav th:replace="~{fragments/asset :: asset}"></nav>
        </div>

        <div class="cont">
            <div class="content">
                <div class="label" th:text="'Top Requester'"></div>

                <div class="txtinput">
                    <div class="container" style="margin: 0 auto;">
                        <div class="row-cols-1">
                            <div class="col">
                                <div class="card" style="min-width: 50%; border: 1px solid #0f7454; background: white;">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h4 class="card-text" th:text="${topRequester}" style="font-size: 20px; font-weight: bold; color: #0f7454;"></h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="label" th:text="'Overview Request Surat Berdasarkan Status'"></div>

                <div class="txtinput">
                    <div class="container">
                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-5">
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${diajukan}"></h2>
                                        <h5 class="card-title">Diajukan</h5>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${dibatalkan}"></h2>
                                        <h5 class="card-title">Dibatalkan</h5>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${ditolak}"></h2>
                                        <h5 class="card-title">Ditolak</h5>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${diproses}"></h2>
                                        <h5 class="card-title">Diproses</h5>
                                    </div>
                                </div>
                            </div>

                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${selesai}"></h2>
                                        <h5 class="card-title">Selesai</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>            
                </div>
            </div>

            <div class="content1">
                <div class="content">
                    <div class="txtinput">
                        <canvas id="myChart2"></canvas>

                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var jumlahRequestPerBulan = /*[[${jumlahRequestPerBulan}]]*/ {};
                            console.log("Data jumlah request per bulan:", jumlahRequestPerBulan);

                            var tahun = /*[[${tahun}]]*/;

                            function getMonthName(monthNumber) {
                                var months = [
                                    "Januari", "Februari", "Maret", "April", "Mei", "Juni",
                                    "Juli", "Agustus", "September", "Oktober", "November", "Desember"
                                ];
                                return months[monthNumber - 1];
                            }

                            var allMonths = [
                                "Januari", "Februari", "Maret", "April", "Mei", "Juni",
                                "Juli", "Agustus", "September", "Oktober", "November", "Desember"
                            ];

                            var labels = [];
                            var data = [];

                            allMonths.forEach(function(month, index) {
                                labels.push(month);
                                data.push(jumlahRequestPerBulan[month] || 0);
                            });

                            var dataChart = {
                                labels: labels,
                                datasets: [{
                                    label: `Statistik Jumlah Request Surat Tahun ${tahun}`,
                                    data: data,
                                    backgroundColor: '#0f7454',
                                    borderColor: '#253237',
                                    borderWidth: 1
                                }]
                            };

                            const configChart = {
                                type: 'line',
                                data: dataChart,
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: false,
                                            ticks: {
                                                callback: function(value, index, values) {
                                                    return value;
                                                }
                                            }
                                        },
                                        x: {
                                            grid: {
                                                display: false
                                            }
                                        }
                                    }
                                }
                            };

                            var myChart = new Chart(
                                document.getElementById('myChart2'),
                                configChart
                            );
                            /*]]>*/
                        </script>
                    </div>
                </div>

                <div class="content">
                    <div class="txtinput">
                        <canvas id="myChart"></canvas>

                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var jumlahRequestPerMinggu = /*[[${jumlahRequestPerMinggu}]]*/ {};
                            console.log("Data jumlah request per minggu:", jumlahRequestPerMinggu);

                            // var bulan = /*[[${bulan}]]*/;

                            var currentYearMonth = /*[[${currentYearMonth}]]*/;
                            var bulanTahun = currentYearMonth.split("-");
                            var tahun = bulanTahun[0];
                            var bulan = bulanTahun[1];

                            function getWeekLabel(weekNumber) {
                                return "Minggu ke-" + weekNumber;
                            }
                        
                            var labels = [];
                            var data = [];

                            Object.keys(jumlahRequestPerMinggu).forEach(function(key) {
                                var tahunBulan = key.split("-");
                                var tahunData = tahunBulan[0];
                                var bulanData = tahunBulan[1];

                                if (tahunData === tahun && bulanData === bulan) {
                                    var mingguData = jumlahRequestPerMinggu[key];
                                    Object.keys(mingguData).forEach(function(minggu) {
                                        labels.push(minggu);
                                        data.push(mingguData[minggu]);
                                    });
                                }
                            });

                            var monthNames = [
                                "Januari", "Februari", "Maret", "April", "Mei", "Juni",
                                "Juli", "Agustus", "September", "Oktober", "November", "Desember"
                            ];

                            var bulanName = monthNames[parseInt(bulan) - 1];
                        
                            var dataChart = {
                                labels: labels,
                                datasets: [{
                                    label: `Statistik Jumlah Request Surat Bulan ${bulanName}`,
                                    data: data,
                                    backgroundColor: '#0f7454',
                                    borderColor: '#253237',
                                    borderWidth: 1
                                }]
                            };
                        
                            const config = {
                                type: 'line',
                                data: dataChart,
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: false,
                                            ticks: {
                                                callback: function(value, index, values) {
                                                    return value;
                                                }
                                            }
                                        },
                                        x: {
                                            grid: {
                                                display: false
                                            }
                                        }
                                    }
                                }
                            };
                        
                            var myChart = new Chart(
                                document.getElementById('myChart'),
                                config
                            );
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>

            <div class="content1">
                <div class="content">
                    <div class="txtinput">
                        <canvas id="lineChartPerformaSurat"></canvas>

                        <script th:inline="javascript">
                            var mapPerformaSurat = [[${performaRequestSurat}]];
                            var labels = Object.keys(mapPerformaSurat);
                            var chartData = labels.map(function(key) {
                                return mapPerformaSurat[key];
                            });
                    
                            const lineChartPerformaSurat = document.getElementById('lineChartPerformaSurat');
                        
                            new Chart(lineChartPerformaSurat, {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        label: 'Statistik Performa Request Surat',
                                        data: chartData,
                                        backgroundColor: '#0f7454',
                                        borderColor: '#253237',
                                        borderWidth: 1
                                    }]
                                }, 
                                options: {
                                    responsive: true,
                                    plugins: {
                                    legend: {
                                        position: 'top',
                                    }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>

                <div class="content">
                    <div class="txtinput">
                        <canvas id="myDonut"></canvas>
                    
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var allRoles = /*[[${allRoles}]]*/ [];
                            var jumlahRequestByRole = /*[[${jumlahRequestByRole}]]*/ {};

                            allRoles.forEach(function(role) {
                                if (!jumlahRequestByRole.hasOwnProperty(role)) {
                                    jumlahRequestByRole[role] = 0;
                                }
                            });
                            
                            var labels = Object.keys(jumlahRequestByRole);
                            var data = Object.values(jumlahRequestByRole);
                            var backgroundColors = ['#0f7454', '#3a8b5a', '#459a7d', '#b1cdb8', '#253237'];
                            
                            var donutData = {
                                labels: labels,
                                datasets: [{
                                    label: '',
                                    data: data,
                                    backgroundColor: backgroundColors.slice(0, labels.length),
                                    borderWidth: 1
                                }]
                            };

                            const donutContent = {
                                type: 'doughnut',
                                data: donutData,
                                options: {
                                    plugins: {
                                        legend: {
                                            position: 'bottom'
                                        },
                                        title: {
                                            display: true,
                                            text: 'Statistik Request Surat Berdasarkan Role'
                                        }
                                    },
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    cutout: '50%'
                                }
                            };

                            var myDonut = new Chart(
                                document.getElementById('myDonut'),
                                donutContent
                            );
                            /*]]>*/
                        </script>                
                    </div>
                </div>
            </div>

            <div class="content1">
                <div class="content">
                    <div class="txtinput">
                        <canvas id="myPieChart"></canvas>

                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var reqTemplateDiterima = /*[[${reqTemplateDiterima}]]*/ 0;
                            var reqTemplateDitolak = /*[[${reqTemplateDitolak}]]*/ 0;
                        
                            var data = {
                                labels: ['Diterima', 'Ditolak'],
                                datasets: [{
                                    label: 'Status',
                                    data: [reqTemplateDiterima, reqTemplateDitolak],
                                    backgroundColor: [
                                        '#459a7d', // Warna untuk Diterima
                                        '#b1cdb8'   // Warna untuk Ditolak
                                    ],
                                    borderWidth: 1
                                }]
                            };
                        
                            const contentPie = {
                                type: 'pie',
                                data: data,
                                options: {
                                    plugins: {
                                        legend: {
                                            position: 'bottom'
                                        }
                                    },
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            position: 'bottom',
                                        },
                                        title: {
                                            display: true,
                                            text: 'Overview Request Template Berdasarkan Status'
                                        }
                                    }
                                }
                            };
                        
                            var myPieChart = new Chart(
                                document.getElementById('myPieChart'),
                                contentPie
                            );
                            /*]]>*/
                        </script>
                    </div>
                </div>

                <div class="content">
                    <div class="txtinput">
                        <canvas id="myCombinedBarChart"></canvas>
                
                        <script th:inline="javascript">
                            /*<![CDATA[*/
                            var jumlahRequestByKategori = /*[[${jumlahRequestByKategori}]]*/ {};
                            var activeTemplateByKategori = /*[[${activeTemplateByKategori}]]*/ {};
                            
                            var allCategories = ["Legal", "SDM", "Keuangan", "Sarana", "Kemahasiswaan"];
                            
                            var requestData = [];
                            var templateData = [];
                            
                            allCategories.forEach(function(category) {
                                requestData.push(jumlahRequestByKategori.hasOwnProperty(category) ? jumlahRequestByKategori[category] : 0);
                                templateData.push(activeTemplateByKategori.hasOwnProperty(category) ? activeTemplateByKategori[category] : 0);
                            });
                
                            var dataChart = {
                                labels: allCategories,
                                datasets: [{
                                    label: "Jumlah Request Surat",
                                    backgroundColor: '#459a7d',
                                    borderColor: '#0f7454',
                                    borderWidth: 1,
                                    data: requestData
                                }, {
                                    label: "Jumlah Template Active",
                                    backgroundColor: '#b1cdb8',
                                    borderColor: '#253237',
                                    borderWidth: 1,
                                    data: templateData
                                }]
                            };
                            
                            var barConfig = {
                                type: 'bar',
                                data: dataChart,
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    },
                                    responsive: true,
                                    plugins: {
                                        legend: {
                                            position: 'bottom',
                                        },
                                        title: {
                                            display: true,
                                            text: 'Overview Request Surat & Template Berdasarkan Kategori'
                                        }
                                    }
                                }
                            };
                            
                            var myCombinedBarChart = new Chart(
                                document.getElementById('myCombinedBarChart'),
                                barConfig
                            );
                            /*]]>*/
                        </script>
                    </div>
                </div>
            </div>            

            <div class="content">
                <div class="label" th:text="'Statistik Jumlah Pertanyaan Yang Masuk Berdasarkan Status'"></div>

                <div class="txtinput">
                    <div class="container">
                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4">
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${notAnsweredFaq}"></h2>
                                        <h5 class="card-title">Belum dijawab</h5>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${dieskalasiFaq}"></h2>
                                        <h5 class="card-title">Dieskalasi</h5>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${answeredFaq}"></h2>
                                        <h5 class="card-title">Terjawab</h5>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col">
                                <div class="card bg-primary text-white mb-4">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                        <h2 class="card-text" th:text="${deletedFaq}"></h2>
                                        <h5 class="card-title">Dihapus</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
                </div>
            </div>

            <div class="content1">
                <div class="content">
                    <div class="txtinput">
                        <canvas id="barChartSuratMasukKeluar"></canvas>
                        
                        <script th:inline="javascript">
                            var mapSuratMasuk = [[${mapSuratMasukMinggu}]];
                            var labels = Object.keys(mapSuratMasuk);
                            var dataSuratMasuk = labels.map(function(key) {
                                return mapSuratMasuk[key];
                            });
                    
                            var mapSuratKeluar = [[${mapSuratKeluarMinggu}]];
                            var labels = Object.keys(mapSuratKeluar);
                            var dataSuratKeluar = labels.map(function(key) {
                                return mapSuratKeluar[key];
                            });
                    
                            const barChartSuratMasukKeluar = document.getElementById('barChartSuratMasukKeluar');
                        
                            new Chart(barChartSuratMasukKeluar, {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        label: "Surat Masuk",
                                        backgroundColor: '#459a7d',
                                        borderColor: '#0f7454',
                                        borderWidth: 1,
                                        data: dataSuratMasuk
                                    }, {
                                        label: "Surat Keluar",
                                        backgroundColor: '#b1cdb8',
                                        borderColor: '#253237',
                                        borderWidth: 1,
                                        data: dataSuratKeluar
                                    }]
                                }, 
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    },
                                    responsive: true,
                                    plugins: {
                                        legend: {
                                            position: 'bottom',
                                        },
                                        title: {
                                            display: true,
                                            text: 'Jumlah Surat Masuk dan Keluar'
                                        }
                                    }
                                }
                            });
                        </script>
                    </div>
                </div>

                <div class="content">
                    <div class="txtinput">
                        <canvas id="pieChartSuratMasuk"></canvas>
                        
                        <script th:inline="javascript">
                            var mapSuratMasukKategori = /*[[${mapSuratMasukKategori}]]*/;
                            var labels = Object.keys(mapSuratMasukKategori);
                            var chartData = Object.values(mapSuratMasukKategori);
                            var backgroundColors = ['#0f7454', '#3a8b5a', '#459a7d', '#b1cdb8', '#253237', '#52828d'];
                        
                            const pieChartSuratMasuk = document.getElementById('pieChartSuratMasuk');
                            
                            new Chart(pieChartSuratMasuk, {
                                type: 'doughnut',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        label: 'Jumlah',
                                        data: chartData,
                                        backgroundColor: backgroundColors.slice(0, labels.length),
                                        borderWidth: 1
                                    }]
                                }, 
                                options: {
                                    responsive: true,
                                    plugins: {
                                        legend: {
                                            position: 'bottom',
                                        },
                                        title: {
                                            display: true,
                                            text: 'Jumlah Surat Masuk Berdasarkan Kategori'
                                        }
                                    },
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    cutout: '50%'
                                }
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
</body>

</html>
